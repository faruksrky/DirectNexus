import{r as p,j as a,D as X,A as Y,B as f,k as M,W as J,n as Z,C as P,o as O,b as k,q as F,s as C,c as U,d as T,t as ee,I as ae,u as se,v as le,w as te,p as ie,x as ne,y as oe,z as re,H as de}from"./index-BAELPupD.js";import{D as ce,T as he,a as c,C as _,F as pe,b as N,c as D,u as xe,g as me,r as ue,d as ge,e as je,f as Se,h as be,i as ve,j as we,k as Te,l as ye,m as fe}from"./filters-result-5c6B_fm6.js";import{s as Pe,S as Ne,M as De,C as Ae,a as ke}from"./Snackbar-Bc5aZZY3.js";import{z as x,i as Fe,u as Ee,t as Oe,a as Re,D as Le,F as m,M as v,b as Ie,L as Be,c as W,C as V,d as H,e as ze,I as Ge,S as Me,O as Ue,T as _e,f as A,g as We,h as Ve}from"./form-provider-DeFHsZwM.js";import{B as He}from"./Button-D0shHWde.js";const $e=x.object({customerFirstName:x.string().min(1,{message:"İsim zorunludur!"}),customerLastName:x.string().min(1,{message:"Soyisim zorunludur!"}),phoneNumber:Pe.phoneNumber({isValidPhoneNumber:Fe}),emailAddress:x.string().email({message:"Geçerli bir e-posta girin!"}),address:x.string().min(1,{message:"Adres zorunludur!"}),productName:x.string().min(1,{message:"Ürün adı zorunludur!"}),faultDescription:x.string().optional(),faultDate:x.string().optional(),servicePersonnel:x.string().optional(),serviceCompletionStatus:x.string().optional(),warrantyStatus:x.string().optional(),cargoStatus:x.string().optional(),operationDate:x.string().optional(),deliveryDate:x.string().optional(),notes:x.string().optional()});function Ke({currentCustomer:e,open:i,onClose:n,fetchData:r,userNamesFromQuick:g}){const j=p.useMemo(()=>({id:(e==null?void 0:e.id)||"",customerFirstName:(e==null?void 0:e.customerFirstName)||"",customerLastName:(e==null?void 0:e.customerLastName)||"",phoneNumber:e!=null&&e.phoneNumber?`+90${e==null?void 0:e.phoneNumber}`:"",emailAddress:(e==null?void 0:e.emailAddress)||"",address:(e==null?void 0:e.address)||"",productName:(e==null?void 0:e.productName)||"",faultDescription:(e==null?void 0:e.faultDescription)||"",faultDate:(e==null?void 0:e.faultDate)||"",servicePersonnel:(e==null?void 0:e.servicePersonnel)||"",serviceCompletionStatus:(e==null?void 0:e.serviceCompletionStatus)||"",operationDate:(e==null?void 0:e.operationDate)||"",warrantyStatus:(e==null?void 0:e.warrantyStatus)||"",cargoStatus:(e==null?void 0:e.cargoStatus)||"",deliveryDate:(e==null?void 0:e.deliveryDate)||"",notes:(e==null?void 0:e.notes)||""}),[e]),l=Ee({resolver:Oe($e),defaultValues:j}),{handleSubmit:s}=l,{reset:o,formState:{isSubmitting:w},watch:y}=l,[R,t]=p.useState(!1),S=y("servicePersonnel"),[$,L]=p.useState(""),[K,I]=p.useState("success"),Q=d=>{const B=["customerLastName","customerFirstName","phoneNumber","emailAddress","address","productName","faultDescription","faultDate"],z=Object.keys(d).filter(b=>!B.includes(b)).reduce((b,G)=>(b[G]=d[G],b),{});B.forEach(b=>{e[b]&&(z[b]=e[b])});const q=`${P.customerUpdateUrl}${e.id}`;O.put(q,z).then(b=>{L("Güncelleme işlemi başarılı!"),I("success"),t(!0),r(),n()}).catch(b=>{console.error("Güncelleme işleminde hata oluştu:",b),L("Güncelleme işleminde hata oluştu!"),I("error"),t(!0)})};return a.jsxs(X,{fullWidth:!0,maxWidth:!1,open:i,onClose:n,PaperProps:{sx:{maxWidth:720}},children:[a.jsxs(Re,{methods:l,onSubmit:s(Q),children:[a.jsx(ce,{children:"Müşteri Teknik Servis Bilgilerini Güncelle"}),a.jsxs(Le,{children:[a.jsx(Y,{variant:"outlined",severity:"info",sx:{mb:3},children:"Bilgileri girdikten sonra güncelle butonuna basınız"}),a.jsxs(f,{rowGap:3,columnGap:2,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"},children:[a.jsx(m.Text,{name:"customerFirstName",label:"İsim",readOnly:!0}),a.jsx(m.Text,{name:"customerLastName",label:"Soyisim",readOnly:!0}),a.jsx(m.Phone,{name:"phoneNumber",label:"Telefon",readOnly:!0}),a.jsx(m.Text,{name:"emailAddress",label:"E-posta",readOnly:!0}),a.jsx(m.Text,{name:"address",label:"Adres",readOnly:!0}),a.jsx(m.Text,{name:"productName",label:"Ürün Adı",readOnly:!0}),a.jsx(m.Text,{name:"faultDescription",label:"Arıza Tanımı",readOnly:!0}),a.jsx(m.DatePicker,{name:"faultDate",label:"Arıza Tarihi",readOnly:!0}),a.jsx(m.Select,{name:"servicePersonnel",label:"Servis Personeli",value:S,children:g.map(d=>a.jsx(v,{value:d,children:d},d))}),a.jsx(m.Select,{name:"serviceCompletionStatus",label:"Servis Durumu",children:M.map(d=>a.jsx(v,{value:d.value,children:d.label},d.value))}),a.jsx(m.Select,{name:"warrantyStatus",label:"Garanti Durumu",children:J.map(d=>a.jsx(v,{value:d.value,children:d.label},d.value))}),a.jsx(m.Select,{name:"cargoStatus",label:"Kargo Durumu",children:Z.map(d=>a.jsx(v,{value:d.value,children:d.label},d.value))}),a.jsx(m.DatePicker,{name:"operationDate",label:"Operasyon Tarihi"}),a.jsx(m.DatePicker,{name:"deliveryDate",label:"Teslim Tarihi"}),a.jsx(m.Text,{name:"notes",label:"Notlar"})]})]}),a.jsxs(Ie,{children:[a.jsx(He,{variant:"outlined",onClick:n,children:"İptal"}),a.jsx(Be,{type:"submit",variant:"contained",tabIndex:-1,children:"Güncelle"})]})]}),a.jsx(Ne,{open:i,autoHideDuration:6e3,children:a.jsx(De,{severity:K,sx:{width:"100%"},children:$})})]})}function u(e){const n=document.createElement("canvas").getContext("2d");return n.font="16px Arial",n.measureText(e).width}function Qe({row:e,selected:i,onEditRow:n,onSelectRow:r,userNames:g,fetchData:j}){k();const l=k(),s=W();return a.jsxs(a.Fragment,{children:[a.jsxs(he,{hover:!0,selected:i,"aria-checked":i,tabIndex:-1,children:[a.jsx(c,{padding:"checkbox",children:a.jsx(V,{id:e.id.toString(),checked:i,onClick:r})}),a.jsx(c,{style:{width:u(e.customerFirstName)},sx:{whiteSpace:"nowrap"},children:e.customerFirstName}),a.jsx(c,{style:{width:u(e.customerLastName)},sx:{whiteSpace:"nowrap"},children:e.customerLastName}),a.jsx(c,{style:{width:u(e.phoneNumber)},sx:{whiteSpace:"nowrap"},children:e.phoneNumber}),a.jsx(c,{style:{width:u(e.emailAddress)},sx:{whiteSpace:"nowrap"},children:e.emailAddress}),a.jsx(c,{style:{width:u(e.address)},sx:{whiteSpace:"nowrap"},children:e.address}),a.jsx(c,{style:{width:u(e.productName)},sx:{whiteSpace:"nowrap"},children:e.productName}),a.jsx(c,{style:{width:u(e.faultDescription)},sx:{whiteSpace:"nowrap"},children:e.faultDescription}),a.jsx(c,{style:{width:u(e.faultDate)},sx:{whiteSpace:"nowrap"},children:e.faultDate}),a.jsx(c,{style:{width:u(e.servicePersonnel)},sx:{whiteSpace:"nowrap"},children:e.servicePersonnel}),a.jsx(c,{style:{width:u(e.warrantyStatus)},sx:{whiteSpace:"nowrap"},children:e.warrantyStatus}),a.jsx(c,{style:{width:u(e.cargoStatus)},sx:{whiteSpace:"nowrap"},children:e.cargoStatus}),a.jsx(c,{style:{width:u(e.serviceCompletionStatus)},sx:{whiteSpace:"nowrap"},children:e.serviceCompletionStatus}),a.jsx(c,{style:{width:u(e.operationDate)},sx:{whiteSpace:"nowrap"},children:e.operationDate}),a.jsx(c,{style:{width:u(e.deliveryDate)},sx:{whiteSpace:"nowrap"},children:e.deliveryDate}),a.jsx(c,{style:{width:u(e.notes)},sx:{whiteSpace:"nowrap"},children:e.notes}),a.jsx(c,{children:a.jsx(F,{direction:"row",alignItems:"center",children:a.jsx(C,{title:"Tabloya Ekle",placement:"top",arrow:!0,children:a.jsx(U,{color:l.value?"inherit":"default",onClick:l.onTrue,children:a.jsx(T,{icon:"solar:pen-bold"})})})})})]}),a.jsx(Ke,{currentCustomer:e,open:l.value,onClose:l.onFalse,userNamesFromQuick:g,fetchData:j}),a.jsx(_,{open:s.open,anchorEl:s.anchorEl,onClose:s.onClose,slotProps:{arrow:{placement:"right-top"}},children:a.jsx(H,{children:a.jsxs(v,{onClick:()=>{n(),s.onClose()},children:[a.jsx(T,{icon:"solar:pen-bold"}),"Edit"]})})})]})}const qe=sessionStorage.getItem(ee);let E=[];const Xe=async()=>{try{E=(await O.get(P.usersListUserName,{headers:{Authorization:`Bearer ${qe}`}})).data}catch(e){console.error("error",e)}},Ye=async()=>(E.length===0&&await Xe(),E);function Je({filters:e,options:i,onResetPage:n}){const r=W(),g=p.useCallback(l=>{n(),e.setState({name:l.target.value})},[e,n]),j=p.useCallback(l=>{const s=typeof l.target.value=="string"?l.target.value.split(","):l.target.value;n(),e.setState({role:s})},[e,n]);return a.jsxs(a.Fragment,{children:[a.jsxs(F,{spacing:2,alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:2.5,pr:{xs:2.5,md:1}},children:[a.jsxs(ze,{sx:{flexShrink:0,width:{xs:200,md:350}},children:[a.jsx(Ge,{htmlFor:"user-filter-role-select-label",children:"Servis Personeli"}),a.jsx(Me,{fullWidth:!0,multiple:!0,value:e.state.role,onChange:j,input:a.jsx(Ue,{label:"ServisPersoneli"}),renderValue:l=>l.map(s=>s).join(", "),inputProps:{id:"user-filter-role-select-label"},MenuProps:{PaperProps:{sx:{maxHeight:240}}},children:i.roles.map(l=>a.jsxs(v,{value:l,children:[a.jsx(V,{disableRipple:!0,size:"small",checked:e.state.role.includes(l)}),l]},l))})]}),a.jsxs(F,{direction:"row",alignItems:"center",spacing:2,flexGrow:1,sx:{width:1},children:[a.jsx(_e,{fullWidth:!0,value:e.state.name,onChange:g,placeholder:"Ara...",InputProps:{startAdornment:a.jsx(ae,{position:"start",children:a.jsx(T,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}}),a.jsx(U,{onClick:r.onOpen,children:a.jsx(T,{icon:"eva:more-vertical-fill"})})]})]}),a.jsx(_,{open:r.open,anchorEl:r.anchorEl,onClose:r.onClose,slotProps:{arrow:{placement:"right-top"}},children:a.jsxs(H,{children:[a.jsxs(v,{onClick:()=>{r.onClose()},children:[a.jsx(T,{icon:"solar:printer-minimalistic-bold"}),"Print"]}),a.jsxs(v,{onClick:()=>{r.onClose()},children:[a.jsx(T,{icon:"solar:import-bold"}),"Import"]}),a.jsxs(v,{onClick:()=>{r.onClose()},children:[a.jsx(T,{icon:"solar:export-bold"}),"Export"]})]})})]})}const Ze=async()=>{try{const e=await O.get(P.customerListUrl);return Array.isArray(e.data)?e.data:[]}catch(e){return console.error("Error fetching customer list",e),[]}};function Ce({filters:e,onResetPage:i,totalResults:n,sx:r}){const g=p.useCallback(()=>{i(),e.setState({name:""})},[e,i]),j=p.useCallback(()=>{i(),e.setState({status:"all"})},[e,i]),l=p.useCallback(o=>{const w=e.state.role.filter(y=>y!==o);i(),e.setState({role:w})},[e,i]),s=p.useCallback(()=>{i(),e.onResetState()},[e,i]);return a.jsxs(pe,{totalResults:n,onReset:s,sx:r,children:[a.jsx(N,{label:"Servis Tamamlanma Durumu:",isShow:e.state.status!=="all",children:a.jsx(A,{...D,label:e.state.status,onDelete:j,sx:{textTransform:"capitalize"}})}),a.jsx(N,{label:"Servis Personeli:",isShow:!!e.state.role.length,children:e.state.role.map(o=>p.createElement(A,{...D,key:o,label:o,onDelete:()=>l(o)}))}),a.jsx(N,{label:"Keyword:",isShow:!!e.state.name,children:a.jsx(A,{...D,label:e.state.name,onDelete:g})})]})}const ea=[{value:"all",label:"Liste"},...M],h=e=>{const n=e.length*8;return Math.max(n,200)},aa=[{id:"customerFirstName",label:"İsim",width:h("İsim")},{id:"customerLastName",label:"Soyisim",width:h("Soyisim")},{id:"phoneNumber",label:"Telefon",width:h("Telefon")},{id:"emailAddress",label:"E-Posta",width:h("E-Posta")},{id:"address",label:"Adres",width:h("Adres")},{id:"productName",label:"Ürün Adı",width:h("Ürün Adı")},{id:"faultDescription",label:"Arıza Tanımı",width:h("Arıza Tanımı")},{id:"faultDate",label:"Arıza Tarihi",width:h("Arıza Tarihi")},{id:"servicePersonnel",label:"Servis Personeli",width:h("Servis Personeli")},{id:"warrantyStatus",label:"Garanti Durumu",width:h("Garanti Durumu")},{id:"cargoStatus",label:"Kargo Durumu",width:h("Kargo Durumu")},{id:"serviceCompletionStatus",label:"Servis Tamamlanma Durumu",width:h("Servis Tamamlanma Durum")},{id:"operationDate",label:"Operasyon Tarihi",width:h("Operasyon Tarihi")},{id:"deliveryDate",label:"Teslim Tarihi",width:h("Teslim Tarihi")},{id:"notes",label:"Notlar",width:h("Notlar")},{id:"",label:"",width:h("")}];function sa(){const e=xe();se();const i=k(),[n,r]=p.useState([]),[g,j]=p.useState([]),l=async()=>{const t=await Ze();r(t)};p.useEffect(()=>{l()},[]),p.useEffect(()=>{(async()=>{const S=await Ye();j(S)})()},[]);const s=le({customerFirstName:"",customerLastName:"",role:[],status:"all"}),o=la({inputData:n,comparator:me(e.order,e.orderBy),filters:s.state});ue(o,e.page,e.rowsPerPage);const w=!!s.state.customerFirstName||!!s.state.customerLastName||s.state.role.length>0||s.state.status!=="all",y=!o.length&&w||!o.length,R=p.useCallback((t,S)=>{e.onResetPage(),s.setState({status:S})},[s,e]);return a.jsxs(a.Fragment,{children:[a.jsx(te,{maxWidth:"xl",children:a.jsxs(f,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start",width:"100%"},children:[a.jsx(Ae,{heading:"Müşteri Teknik Servis Bilgileri",links:[{name:"Dashboard",href:ie.dashboard.root},{name:"Teknik Servis Listesi"}],sx:{mb:{xs:3,md:5}}}),a.jsxs(ke,{sx:{width:"100%",overflowX:"auto"},children:[a.jsx(We,{value:s.state.status,onChange:R,sx:{px:2.5,boxShadow:t=>`inset 0 -2px 0 0 ${ne(t.vars.palette.grey["500Channel"],.08)}`},children:ea.map(t=>a.jsx(Ve,{iconPosition:"end",value:t.value,label:t.label,icon:a.jsx(oe,{variant:(t.value==="all"||t.value===s.state.status)&&"filled"||"soft",color:t.value==="Teslim_Edildi"&&"success"||t.value==="Tamamlandı"&&"warning"||t.value==="Beklemede"&&"error"||"default",children:["Teslim_Edildi","Tamamlandı","Beklemede"].includes(t.value)?n.filter(S=>S.serviceCompletionStatus===t.value).length:n.length})},t.value))}),a.jsx(Je,{filters:s,onResetPage:e.onResetPage,options:{roles:g}}),w&&a.jsx(Ce,{filters:s,totalResults:o.length,onResetPage:e.onResetPage,sx:{p:2.5,pt:0}}),a.jsxs(f,{sx:{position:"relative"},children:[a.jsx(ge,{dense:e.dense,numSelected:e.selected.length,rowCount:o.length,onSelectAllRows:t=>e.onSelectAllRows(t,o.map(S=>S.id))}),a.jsx(f,{sx:{position:"relative",height:"500px",display:"flex",justifyContent:"flex-start",width:"100%",overflowX:"auto"},children:a.jsx(re,{children:a.jsxs(je,{size:e.dense?"small":"medium",sx:{minWidth:1500,width:"100%"},children:[a.jsx(Se,{order:e.order,orderBy:e.orderBy,headLabel:aa,rowCount:o.length,numSelected:e.selected.length,onSort:e.onSort,onSelectAllRows:t=>e.onSelectAllRows(t,o.map(S=>S.id))}),a.jsxs(be,{children:[o.slice(e.page*e.rowsPerPage,e.page*e.rowsPerPage+e.rowsPerPage).map(t=>a.jsx(Qe,{fetchData:l,row:t,selected:e.selected.includes(t.id),onSelectRow:()=>e.onSelectRow(t.id),userNames:g},t.id)),a.jsx(ve,{height:e.dense?56:76,emptyRows:we(e.page,e.rowsPerPage,o.length)}),a.jsx(Te,{notFound:y})]})]})})})]}),a.jsx(ye,{page:e.page,dense:e.dense,count:o.length,rowsPerPage:e.rowsPerPage,onPageChange:e.onChangePage,onChangeDense:e.onChangeDense,onRowsPerPageChange:e.onChangeRowsPerPage})]})]})}),a.jsx(fe,{open:i.value,onClose:i.onFalse})]})}function la({inputData:e,comparator:i,filters:n}){const{role:r,name:g,status:j}=n;if(!Array.isArray(e))return console.error("inputData is not an array:",e),[];const l=e.map((s,o)=>[s,o]);return l.sort((s,o)=>{const w=i(s[0],o[0]);return w!==0?w:s[1]-o[1]}),e=l.map(s=>s[0]),r.length&&(e=e.filter(s=>r.includes(s.servicePersonnel))),g&&(e=e.filter(s=>s.customerFirstName.toLowerCase().indexOf(g.toLowerCase())!==-1)),j!=="all"&&(e=e.filter(s=>s.serviceCompletionStatus===j)),e}const ta={title:`Müşteri Servis Listesi | Dashboard - ${P.appName}`};function ca(){return a.jsxs(a.Fragment,{children:[a.jsx(de,{children:a.jsx("title",{children:ta.title})}),a.jsx(sa,{})]})}export{ca as default};
